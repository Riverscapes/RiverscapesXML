<Protocol machine_code="RIM" version="1.0" status="production" protocol_type="dce" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../protocol.xsd">
    <Label>Riverscape Inundation Mapping</Label>
    <Description>Protocol to aid in efficient mapping of structurally forced inundation patterns in beaver impacted riverscapes</Description>
    <URL>https://rim.riverscapes.net/</URL>
    <Citation>Bartelt KM, Belmont P, Gilbert JT, Hammill E, Macfarlane WW, Saunders WC, et al. (2025) Mapping valley bottom inundation patterns from beaver dam activity: A potential proxy for hydrologic inefficiency. PLOS Water 4(11): e0000428. DOI: 10.1371/journal.pwat.0000428</Citation>
    <Author>Karen Bartelt</Author>
    <CreationDate>2025-02-05</CreationDate>
    <UpdatedDate>2025-02-05</UpdatedDate>
    <MetaData>
        <Meta name=""></Meta>
    </MetaData>
    <Layers>
        <Layer id="dam_crests" version="1.0" geom_type="Linestring">
            <Label>Dam Crests</Label>
            <Symbology>dam_crests_rim.qml</Symbology>
            <Description>Representation of the top of a beaver dam</Description>
            <Hierarchy>
                <HierarchyItem>RIM Protocol Layers</HierarchyItem>
            </Hierarchy> 
            <Fields>
                <ListField id="dam_state" version="1.0">
                    <Label>Dam State</Label>
                    <Values>
                        <Value>Blown Out</Value>
                        <Value>Breached</Value>
                        <Value>Intact</Value>
                    </Values>              
                </ListField>
                <ListField id="crest_type" version="1.0">
                    <Label>Crest Type</Label>
                    <Values>
                        <Value>Active</Value>
                        <Value>Inactive</Value>
                    </Values>
                </ListField>
            </Fields>
        </Layer>
        <Layer id="thalwegs" version="1.0" geom_type="Linestring">
            <Label>Thalwegs</Label>
            <Symbology>thalwegs_rim.qml</Symbology>
            <Description>The deepest part of the active channel, if imagery doesnt allow map he centerline of the channel</Description>
            <Hierarchy>
                <HierarchyItem>RIM Protocol Layers</HierarchyItem>
            </Hierarchy> 
            <Fields>
                <ListField id="type_id" version="1.0">
                    <Label>Type</Label>
                    <Values>
                        <Value>Main</Value>
                        <Value>Anabranch</Value>
                        <Value>Split</Value>
                        <Value>Braid</Value>
                    </Values>
                </ListField>   
            </Fields>
        </Layer>
        <Layer id="inundation" version="1.0" geom_type="Polygon">
            <Label>Inundation</Label>
            <Symbology>inundation_extents_rim.qml</Symbology>
            <Description>The wetted extent of the riverscape divided into 3 different categories</Description>
            <Hierarchy>
                <HierarchyItem>RIM Protocol Layers</HierarchyItem>
            </Hierarchy>    
            <Fields>
                <ListField id="type_id" version="1.0">
                    <Label>Type</Label>
                    <Values>
                        <Value>Free Flowing</Value>
                        <Value>Overflow</Value>
                        <Value>Ponded</Value>
                    </Values>
                </ListField>
            </Fields>
        </Layer>
    </Layers>
    <Metrics>
        <Metric id="riverscape_area" version="1.0" calculation_machine_code="area">
            <Label>Valley Area</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The area of the riverscape valley bottom within the sample frame</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Site and Hydrogeomorphic</HierarchyItem>
                <HierarchyItem>Condition Independant</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <InputLayer input_ref="valley_bottom" usage="metric_layer"/>
            </Parameters>
        </Metric>
        <Metric id="riverscape_length" version="1.0" calculation_machine_code="length">
            <Label>Valley Length</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The length of the riverscape centerline within the sample frame</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Site and Hydrogeomorphic</HierarchyItem>
                <HierarchyItem>Condition Independant</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <InputLayer input_ref="centerline" usage="metric_layer"/>
            </Parameters>
        </Metric>
        <!-- <Metric id="integrated_valley_width" version="1.0" calculation_machine_code="proportion">
            <Label>Integrated Valley Width</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>Valley width, the area of the valley divided by the valley centerline length</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Parameters>
                <InputLayer input_ref="valley_bottom" usage="numerator"/>
                <InputLayer input_ref="centerline" usage="denominator" />
            </Parameters>
        </Metric> -->
        <Metric id="valley_gradient" version="1.0" calculation_machine_code="gradient">
            <Label>Valley Gradient</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The gradient of the valley centerline</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Site and Hydrogeomorphic</HierarchyItem>
                <HierarchyItem>Condition Independant</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <InputLayer input_ref="dem" usage="surface"/>
                <InputLayer input_ref="centerline" usage="metric_layer"/> 
            </Parameters>
        </Metric>
       <Metric id="channel_gradient" version="1.0" calculation_machine_code="gradient">
            <Label>Channel Gradient</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The channel gradient of the main channel</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Site and Hydrogeomorphic</HierarchyItem>
                <HierarchyItem>Condition Dependant</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <InputLayer input_ref="dem" usage="surface"/>
                <DCELayer layer_id_ref="thalwegs">
                    <AttributeFilter field_id_ref="type_id">
                        <Value>Main</Value>
                    </AttributeFilter>
                </DCELayer> 
            </Parameters>
        </Metric>
        <Metric id="thalweg_length_main" version="1.0" calculation_machine_code="length">
            <Label>Channel Length (main)</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The length of the main channel within the riverscape sample frame</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <MaximumValue>1000000</MaximumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Site and Hydrogeomorphic</HierarchyItem>
                <HierarchyItem>Condition Dependant</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="thalwegs">
                    <AttributeFilter field_id_ref="type_id">
                        <Value>Main</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="thalweg_length_all" version="1.0" calculation_machine_code="length">
            <Label>Channel Length (all)</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The length of the all channels within the riverscape sample frame</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <MaximumValue>1000000</MaximumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Site and Hydrogeomorphic</HierarchyItem>
                <HierarchyItem>Condition Dependant</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="thalwegs">
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="percent_thalweg_main" version="1.0" calculation_machine_code="proportion">
            <Label>Proportion of Total Thalweg that is the Main Thalweg </Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The percent of the thalwegs that is the main thalweg</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Site and Hydrogeomorphic</HierarchyItem>
                <HierarchyItem>Condition Dependant</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="thalwegs">
                    <Usage>Numerator</Usage>
                    <AttributeFilter field_id_ref="type_id">
                        <Value>Main</Value>
                    </AttributeFilter>
                </DCELayer>
                <DCELayer layer_id_ref="thalwegs">
                    <Usage>Denominator</Usage>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="sinuosity" version="1.0" calculation_machine_code="sinuosity">
            <Label>Sinuosity (main)</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The sinuosity of the main channel in the riverscape sample frame</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Site and Hydrogeomorphic</HierarchyItem>
                <HierarchyItem>Condition Dependant</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="thalwegs">
                    <AttributeFilter field_id_ref="type_id">
                        <Value>Main</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="relative_flow_length" version="1.0" calculation_machine_code="length">
            <Label>Relative Flow Length</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The sum of all channel lengths per length of riverscape</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Site and Hydrogeomorphic</HierarchyItem>
                <HierarchyItem>Condition Dependant</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <InputLayer input_ref="centerline" usage="normalization"/>          
                <DCELayer layer_id_ref="thalwegs"/>
            </Parameters>
        </Metric>
        <Metric id="dam_count" version="1.0" calculation_machine_code="count">
            <Label>Number of Dams</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The number of beaver dams in each sample frame</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>1</Precision>
            <Hierarchy>
                <HierarchyItem>Structural Forcing</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="dam_crests">
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="dam_density" version="1.0" calculation_machine_code="count">
            <Label>Dam Density</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The number of beaver dams per length of riverscape</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Structural Forcing</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <InputLayer input_ref="centerline" usage="normalization"/>
                <DCELayer layer_id_ref="dam_crests">
                    <Usage>Numerator</Usage>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="dam_count_intact" version="1.0" calculation_machine_code="count">
            <Label>Number of Intact Dams</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The number of intact beaver dams in each sample frame</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>1</Precision>
            <Hierarchy>
                <HierarchyItem>Structural Forcing</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="dam_crests">
                    <AttributeFilter field_id_ref="dam_state"> 
                        <Value>Intact</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="dam_density_intact" version="1.0" calculation_machine_code="count">
            <Label>Intact Dam Density</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The number of intact beaver dams per length of riverscape</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Structural Forcing</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <InputLayer input_ref="centerline" usage="normalization"/>
                <DCELayer layer_id_ref="dam_crests">
                    <Usage>Numerator</Usage>
                    <AttributeFilter field_id_ref="dam_state"> 
                        <Value>Intact</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="dam_count_breached" version="1.0" calculation_machine_code="count">
            <Label>Number of Breached Dams</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The number of breached beaver dams in each sample frame</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>1</Precision>
            <Hierarchy>
                <HierarchyItem>Structural Forcing</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="dam_crests">
                    <AttributeFilter field_id_ref="dam_state"> 
                        <Value>Breached</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="dam_density_breached" version="1.0" calculation_machine_code="count">
            <Label>Breached Dam Density</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The number of breached beaver dams per length of riverscape</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Structural Forcing</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <InputLayer input_ref="centerline" usage="normalization"/>
                <DCELayer layer_id_ref="dam_crests">
                    <Usage>Numerator</Usage>
                    <AttributeFilter field_id_ref="dam_state"> 
                        <Value>Breached</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="dam_count_blownout" version="1.0" calculation_machine_code="count">
            <Label>Number of Blown Out Dams</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The number of blown out beaver dams in each sample frame</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>1</Precision>
            <Hierarchy>
                <HierarchyItem>Structural Forcing</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="dam_crests">
                    <AttributeFilter field_id_ref="dam_state"> 
                        <Value>Blown Out</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="dam_density_blownout" version="1.0" calculation_machine_code="count">
            <Label>Blown Out Dam Density</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The number of blown out beaver dams per length of riverscape</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Structural Forcing</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <InputLayer input_ref="centerline" usage="normalization"/>
                <DCELayer layer_id_ref="dam_crests">
                    <Usage>Numerator</Usage>
                    <AttributeFilter field_id_ref="dam_state"> 
                        <Value>Blown Out</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="crest_length_ratio_all" version="1.0" calculation_machine_code="proportion">
            <Label>Ratio of Dam Crest Length to Valley Length (all dams)</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The ratio of all dams crest length to to the valley length </Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Structural Forcing</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <InputLayer input_ref="centerline" usage="denominator"/>
                <DCELayer layer_id_ref="dam_crests">
                    <Usage>Numerator</Usage>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="crest_length_structurally_forcing" version="1.0" calculation_machine_code="proportion">
            <Label>Percent of Dam Crest Length that is Actively Structurally Forcing Flow</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The ratio of  dam crest length that is classified as actively structurally forcing flow to the length of all dam crests</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Structural Forcing</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="dam_crests">
                    <Usage>Numerator</Usage>
                    <AttributeFilter field_id_ref="crest_type">
                        <Value>Active</Value>
                    </AttributeFilter>
                </DCELayer>
                <DCELayer layer_id_ref="dam_crests">
                    <Usage>Denominator</Usage>
                </DCELayer>
            </Parameters>
        </Metric>
        <!-- <Metric id="integrated_wetted_width" version="1.0" calculation_machine_code="proportion">
            <Label>Wetted width, the area of all inundation divided by the valley centerline length</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description></Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Parameters>
                <InputLayer input_ref="centerline" usage="denominator"/>
                <DCELayer layer_id_ref="inundation">
                    <Usage>numerator</Usage>
                </DCELayer>
            </Parameters>
        </Metric> -->
         <Metric id="total_inundated_area" version="1.0" calculation_machine_code="area">
            <Label>Total Inundated Area</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The inundated area of all 3 classifications added together</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Inundation</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="inundation">
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="free_flowing_area" version="1.0" calculation_machine_code="area">
            <Label>Total Area of Free Flowing Inundation</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The area of free flowing inundation type</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Inundation</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="inundation">
                    <AttributeFilter field_id_ref="type_id">
                            <Value>Free Flowing</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="ponded_area" version="1.0" calculation_machine_code="area">
            <Label>Total Area of Ponded Inundation</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The area of ponded inundation type</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Inundation</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="inundation">
                    <AttributeFilter field_id_ref="type_id">
                            <Value>Ponded</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="overflow_area" version="1.0" calculation_machine_code="area">
            <Label>Total Area of Overflow Inundation</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>the area of overflow inundation type</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Inundation</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="inundation">
                    <AttributeFilter field_id_ref="type_id">
                            <Value>Overflow</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="percent_inundated" version="1.0" calculation_machine_code="area_proportion">
            <Label>Percent of the Valley Bottom that is Inundated</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The percent of the riverscape that is inundated</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Inundation</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="inundation">
                    <Usage>Numerator</Usage>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="percent_free_flowing" version="1.0" calculation_machine_code="area_proportion">
            <Label>Percent of the Valley Bottom with Free Flowing Inundation</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The percent of the riverscape that is free flowing</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Inundation</HierarchyItem>
            </Hierarchy>
            <Parameters>                
                <DCELayer layer_id_ref="inundation">
                    <Usage>Numerator</Usage>
                    <AttributeFilter field_id_ref="type_id">
                        <Value>Free Flowing</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="percent_ponded" version="1.0" calculation_machine_code="area_proportion">
            <Label>Percent of the Valley Bottom with Ponded Inundation</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The percent of the riverscape that is ponded</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Inundation</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="inundation">
                    <Usage>Numerator</Usage>
                    <AttributeFilter field_id_ref="type_id">
                        <Value>Ponded</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
        <Metric id="percent_overflow" version="1.0" calculation_machine_code="area_proportion">
            <Label>Percent of the Valley Bottom with Overflow Inundation</Label>
            <DefaultLevel>Metric</DefaultLevel>
            <Description>The percent of the riverscape that is overflow</Description>
            <DefinitionURL/>
            <MinimumValue>0</MinimumValue>
            <Precision>3</Precision>
            <Hierarchy>
                <HierarchyItem>Inundation</HierarchyItem>
            </Hierarchy>
            <Parameters>
                <DCELayer layer_id_ref="inundation">
                    <Usage>Numerator</Usage>
                    <AttributeFilter field_id_ref="type_id">
                        <Value>Overflow</Value>
                    </AttributeFilter>
                </DCELayer>
            </Parameters>
        </Metric>
    </Metrics>
</Protocol>
